<div class="newAffaire">
    <md-toolbar class="md-card">
        <div class="md-title" style="font-weight: 700;">Nouvelle affaire</div>
    </md-toolbar>

    <form novalidate class="md-layout" @submit.prevent="validateForm">
        <md-card>
            <md-card-content>

                <div class="md-layout md-gutter">
                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('nom')">
                            <label for="nom">Nom</label>
                            <md-input name="nom" id="nom" v-model="form.nom" :disabled="sending" />
                        </md-field>
                        </div>

                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('nom')">
                            <label for="nom">Information</label>
                            <md-input name="information" id="information" v-model="form.information" :disabled="sending" />
                        </md-field>
                    </div>    
                    
                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('vref')">
                            <label for="vref">Vref</label>
                            <md-input name="vref" id="vref" v-model="form.vref" :disabled="sending" />
                        </md-field>
                    </div>
                </div>

                <div class="md-layout md-gutter">
                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('type_id')">
                            <label for="type_id">Type affaire</label>
                            <md-select name="type_id" id="type_id" v-model="form.type_id" :disabled="sending">
                            <md-option v-for="item in types_affaires_list" :key="item.id" :value="item.id">{{item.nom}}</md-option>
                            </md-select>
                            <span class="md-error" v-if="!$v.form.type_id.required">Le type affaire est obligatoire</span>
                        </md-field>
                    </div>

                    <div class="md-layout-item md-small-size-100">
                        <md-field style="margin: -15px 0 0 0 !important;height: 68px !important;" :class="getValidationClass('client_commande_id')">
                            <!--<label for="client_commande_id">Client commande</label>
                             <md-select name="client_commande_id" id="client_commande_id" v-model="form.client_commande_id" :disabled="sending">
                            <md-option v-for="item in clients_list" :key="item.id" :value="item.id">{{item.nom}}</md-option>
                            </md-select> -->

                            <md-autocomplete id="client_commande_id" v-model="form.client_commande_id" :md-options="search_clients_list" md-dense  @md-changed="searchClients(form.client_commande_id)">
                                <label>Client commande</label>
                            </md-autocomplete>
                            <span class="md-error" v-if="!$v.form.client_commande_id.required">Le client commande est obligatoire</span>
                        </md-field>
                    </div>

                    <div class="md-layout-item md-small-size-100">
                        <md-field style="margin: -15px 0 0 0 !important;height: 68px !important;" :class="getValidationClass('client_commande_par_id')">
                            <!-- <label for="client_commande_par_id">Client commande par.</label>
                            <md-select name="client_commande_par_id" id="client_commande_par_id" v-model="form.client_commande_par_id" :disabled="sending">
                            -->
                            <md-autocomplete id="client_commande_par_id" v-model="form.client_commande_par_id" :md-options="search_clients_list" md-dense  @md-changed="searchClients(form.client_commande_par_id)">
                                <label>Client commande par.</label>
                            </md-autocomplete>
                            </md-select>
                        </md-field>
                    </div> 
                </div>

                <div class="md-layout md-gutter">
                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('responsable_id')">
                            <label for="responsable_id">Responsable</label>
                            <md-select name="responsable_id" id="responsable_id" v-model="form.responsable_id" :disabled="sending">
                            <md-option v-for="item in responsables_list" :key="item.id" :value="item.id">{{item.nom}}</md-option>
                            </md-select>
                            <span class="md-error" v-if="!$v.form.responsable_id.required">Le responsable est obligatoire</span>
                        </md-field>
                    </div>

                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('technicien_id')">
                            <label for="technicien_id">Technicien</label>
                            <md-select name="technicien_id" id="technicien_id" v-model="form.technicien_id" :disabled="sending">
                            <md-option v-for="item in operateurs_list" :key="item.id" :value="item.id">{{item.nom}}</md-option>
                            </md-select>
                            <span class="md-error" v-if="!$v.form.technicien_id.required">Le technicien est obligatoire</span>
                        </md-field>
                    </div>

                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('cadastre_id')">
                            <label for="cadastre_id">Cadastre</label>
                            <md-select name="cadastre_id" id="cadastre_id" v-model="form.cadastre_id" :disabled="sending">
                            <md-option v-for="item in cadastres_list" :key="item.id" :value="item.id">{{item.nom}}</md-option>
                            </md-select>
                            <span class="md-error" v-if="!$v.form.cadastre_id.required">Le type cadastre est obligatoire</span>
                        </md-field>
                    </div>
                </div>

                <div class="md-layout md-gutter">
                    <div class="md-layout-item md-small-size-100">
                        <md-datepicker v-model="form.date_ouverture" md-immediately :class="getValidationClass('date_ouverture')">
                            <label>Date ouverture</label>
                            </md-datepicker>
                    </div>

                    <div class="md-layout-item md-small-size-100">
                        <md-datepicker v-model="form.date_validation" md-immediately :class="getValidationClass('date_validation')">
                            <label>Date validation</label>
                            </md-datepicker>
                    </div>

                    <div class="md-layout-item md-small-size-100">
                        <md-datepicker v-model="form.date_cloture" md-immediately :class="getValidationClass('date_cloture')">
                            <label>Date clôture</label>
                            </md-datepicker>
                    </div>
                </div>

                

                <div class="md-layout md-gutter">
                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('localisation_E')">
                            <label for="localisation_E">Localisation_E</label>
                            <md-input name="localisation_E" id="localisation_E" v-model="form.localisation_E" :disabled="sending" />
                            <span class="md-error" v-if="!$v.form.localisation_E.required">La localisation_E est obligatoire</span>
                        </md-field>
                        
                    </div>  
                    
                    <div class="md-layout-item md-small-size-100">
                        <md-field :class="getValidationClass('localisation_N')">
                            <label for="localisation_N">Localisation_N</label>
                            <md-input name="localisation_N" id="localisation_N" v-model="form.localisation_N" :disabled="sending" />
                            <span class="md-error" v-if="!$v.form.localisation_N.required">La localisation_N est obligatoire</span>
                        </md-field>
                    </div>    
                    <div class="md-layout-item md-small-size-100"></div>
                    <div class="md-layout-item md-small-size-100"></div>    
                    <div class="md-layout-item md-small-size-100"></div>
                    <div class="md-layout-item md-small-size-100"></div>
                </div>
                    
                <div  class="md-layout md-gutter mapHeight" id="mapContainer">
                    <MapHandler ref="mapHandler"/>
                </div>
            </md-card-content>
            
            <md-card-actions>
                <md-button class="md-raised" :disabled="sending" v-on:click="cancelEdit">Annuler</md-button>
                <md-button type="submit" class="md-raised md-primary" :disabled="sending">Enregistrer</md-button>
            </md-card-actions>
        </md-card>

        <md-snackbar :md-active.sync="dataSaved">L'affaire {{ lastRecord }} a été enregistré avec succès</md-snackbar>
    </form>
</div>